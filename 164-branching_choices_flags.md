# 분기·선택지·플래그 시스템 작성 가이드

## 1. 목적 (Purpose)
게임의 분기, 선택지, 플래그 시스템을 체계적으로 설계하여 플레이어 선택의 의미와 스토리 다양성을 극대화하기 위한 가이드입니다.

## 2. 범위 (Scope)
- **포함**: 분기 구조 설계, 선택지 설계, 플래그 시스템, 상태 관리, 멀티엔딩
- **제외**: 구체적인 코드 구현, 데이터베이스 설계, UI/UX 구현

## 3. 설계 목표 (Design Goals)

1. **의미 있는 선택 (Meaningful Choices)**: 모든 선택이 스토리와 게임플레이에 실제 영향을 미치며, 플레이어가 결과를 예측할 수 있습니다.
2. **관리 가능한 복잡성 (Manageable Complexity)**: 분기가 과도하게 복잡하지 않으면서도 다양성을 제공합니다.
3. **재플레이 가치 (Replay Value)**: 다양한 선택 경로로 재플레이 동기를 제공합니다.
4. **기술적 실행 가능성 (Technical Feasibility)**: 플래그 시스템이 구현 가능하고 유지보수가 용이합니다.

## 4. GDD 문서 구조 (Structure)

### 4.1 분기 구조 (Branching Structure)
- **분기 맵**: 전체 분기 구조 시각화
- **주요 분기점**: 핵심 선택 포인트

### 4.2 선택지 & 플래그 (Choices & Flags)
- **선택지 설계**: 각 선택의 의미와 결과
- **플래그 시스템**: 상태 추적, 조건 분기

### 4.3 엔딩 & 검증 (Endings & Validation)
- **멀티엔딩**: 다양한 결말 조건
- **검증 계획**: 모든 경로 테스트

### 4.4 선택 및 심화 (Optional & Advanced)
- **데이터 관리**: 플래그(Flag) 네이밍 컨벤션, 세이브 파일 용량 최적화(Bitmasking)
- **디버깅**: 플래그 강제 변경(Set/Unset) 치트 기능, 현재 활성화된 분기 시각화 툴
- **예외 처리**: 논리적 모순(Dead End) 방지, 미사용 플래그 정리 프로세스

## 5. 관련 개념 (Key Concepts)

- **Branching Point**: 플레이어 선택에 따라 다른 경로로 분기되는 지점
- **Flag System**: 게임 상태를 추적하는 변수 시스템
- **State Machine**: 게임 상태 전환을 관리하는 시스템
- **Consequence Tracking**: 선택의 장기적 영향 추적

## 6. 품질 체크리스트 (Quality Checklist)

### 6.1 분기 설계
- [ ] 분기 구조가 시각적으로 명확하게 표현되었는가?
- [ ] 모든 분기점에서 선택의 의미가 명확한가?
- [ ] 분기 복잡도가 관리 가능한 수준인가?

### 6.2 선택 & 플래그
- [ ] 모든 선택이 실제 결과를 가져오는가?
- [ ] 플래그 시스템이 모든 상태를 추적할 수 있는가?
- [ ] 플래그 간 충돌이나 모순이 없는가?

### 6.3 완성도
- [ ] 모든 엔딩 조건이 명확하게 정의되었는가?
- [ ] 모든 경로가 테스트되었는가?
- [ ] 재플레이 시 다른 경험을 제공하는가?

## 7. 예시 및 안티패턴 (Examples & Anti-Patterns)

**Case 1: 의미 있는 분기**
- **좋은 예 (Good)**: "선택 A: NPC 구출 → 동료 획득, 후반 지원 / 선택 B: NPC 무시 → 즉각적 보상, 후반 적대, 각 선택이 장기적 영향"
- **안티패턴 (Bad)**: "선택지가 있지만 결과가 동일하여 의미 없음"

**Case 2: 플래그 시스템 (As Dusk Falls)**
- **좋은 예 (Good)**: "브랜칭 스토리의 6가지 원칙 적용, 모든 선택지가 의미 있는 감정적 경험 제공, 멀티버스 접근으로 재플레이성 확보"
- **안티패턴 (Bad)**: "플래그 관리 부실로 스토리 모순 발생"

**Case 3: 멀티엔딩**
- **좋은 예 (Good)**: "5가지 엔딩 - 각 엔딩이 플레이어 선택을 반영, 명확한 조건, 감정적으로 만족스러운 결말"
- **안티패턴 (Bad)**: "엔딩이 플레이어 선택과 무관하게 랜덤으로 결정"

## 8. 핵심 인사이트 (Key Insights)

- **브랜칭 원칙 (As Dusk Falls)**: 구조적 논리와 감정적 스토리텔링의 균형을 유지하고, 모든 선택지가 의미 있는 경험을 제공하도록 설계하세요.
- **멀티버스 접근**: 플레이어 선택의 자유 안에서 내러티브 일관성을 유지하세요.
- **플래그 관리**: 체계적인 플래그 시스템으로 모든 상태를 추적하고, 모순을 방지하세요.
- **재플레이 가치**: 다양한 경로와 엔딩으로 플레이어가 다른 선택을 탐험하도록 유도하세요.
